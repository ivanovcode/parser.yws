function ajax(a,b,c){var d=new XMLHttpRequest;d.open("POST",a,!0),d.setRequestHeader("Content-Type","application/json"),d.onreadystatechange=function(){4==this.readyState&&c(200==this.status?this.responseText:this.responseText)},d.send(b)}function pushJSON(a){var b={};b.success="false",console.log(JSON.stringify(b)),a.exit()}var page=require("webpage").create(),system=require("system"),args=system.args,data=[],clientKey=system.args[1],url=[];""!=system.args[5]&&url.push("db="+system.args[5]),""!=system.args[6]&&url.push("period="+system.args[6]),""!=system.args[4]&&url.push("words="+encodeURIComponent(system.args[4])),url="https://wordstat.yandex.ru/#!/history?"+url.join("&"),page.settings.userAgent="Mozilla/5.0 (Windows NT 6.1; WOW64; rv:34.0) Gecko/20100101 Firefox/34.0",page.open(url,function(a){page.includeJs("https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js",function(){page.evaluate(function(a){var c=(document.getElementsByClassName("b-domik_type_popup")[0],document.getElementById("b-domik_popup-username")),d=document.getElementById("b-domik_popup-password");c.value=a[2],d.value=a[3],$(document).ready(function(){$(".b-form-button__input").click()})},args),setTimeout(function(){page.evaluate(function(){$(document).ready(function(){$(".b-form-button__input").click()})})},5e3),setTimeout(function(){page.evaluate(function(){var a=document.getElementsByClassName("b-popupa__content")[0],b=a.getBoundingClientRect();return b},"clipRect");page.clipRect={top:174,left:395,width:175,height:71};var b=page.renderBase64("PNG"),c='{"clientKey":"'+clientKey+'","task":{"type":"ImageToTextTask","body":"'+b+'","phrase":false,"case":false,"numeric":false,"math":0,"minLength":0,"maxLength":0}}';ajax("http://api.anti-captcha.com/createTask",c,function(a){var c,a=JSON.parse(a),b='{"clientKey":"'+clientKey+'","taskId":"'+a.taskId+'"}',d=setInterval(function(){ajax("http://api.anti-captcha.com/getTaskResult",b,function(a){var a=JSON.parse(a);"ready"==a.status&&(c=a.solution.text,clearInterval(d))})},1e4),e=setInterval(function(){if(void 0!=c){for(var b=(page.evaluate(function(a){var b=document.getElementsByClassName("b-form-input__input")[1];return b.focus(),b},c),0),d=c.length;b<d;b++)page.sendEvent("keypress",c[b]);setTimeout(function(){page.sendEvent("keypress",page.event.key.Enter)},5e3),setTimeout(function(){page.clipRect={left:0,top:0,width:0,height:0};var a={};a.success="true",a.balance="",a.filters={},a.filters.db=system.args[5],a.filters.period=system.args[6],a.filters.word=system.args[4],a.response={},a.response.history={};var b=page.evaluate(function(a){for(var b=0,c={},d=0;d<=1;d++){var e=document.getElementsByClassName("b-history__table-body")[d];"undefined"==typeof e&&a(phantom);for(var g=0;g<e.childNodes.length;g++){var h=e.childNodes[g];1==h.nodeType&&(b++,c[b]={},c[b].period=h.getElementsByTagName("td")[0].outerText,c[b].value=h.getElementsByClassName("b-history__value-td")[0].outerText)}}return document.getElementsByClassName("b-form-radio__radio")[1].click(),c},pushJSON);a.response.history=b;var c,d='{"clientKey":"'+clientKey+'"}';ajax("http://api.anti-captcha.com/getBalance",d,function(a){var a=JSON.parse(a);c=a.balance});var e=setInterval(function(){"undefined"!=typeof c&&(clearInterval(e),a.balance=c,console.log(JSON.stringify(a)),phantom.exit())},1e3)},1e4),clearInterval(e)}},1e4)})},1e4)})});